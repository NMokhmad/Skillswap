<%- include('../partials/header.ejs') %>
</head>

<body>
    <%- include('../partials/navbar.ejs') %>

    <div class="ss-reg-page">
        <div class="ss-reg-card">

            <!-- En-tête -->
            <div class="ss-reg-header">
                <h1 class="ss-reg-title">Rejoignez <em>Skill</em><strong>Swap</strong></h1>
                <p class="ss-reg-subtitle">Créez votre compte gratuitement</p>
            </div>

            <hr class="ss-reg-divider">

            <!-- Formulaire -->
            <form action="/register" method="POST">

                <!-- Nom + Prénom côte à côte -->
                <div class="ss-reg-row">

                    <!-- Nom -->
                    <div class="ss-reg-field<% if (errors && errors.lastname) { %> has-error<% } %>">
                        <label class="ss-reg-label" for="lastname">Nom</label>
                        <div class="ss-reg-input-wrap">
                            <input
                                class="ss-reg-input"
                                type="text"
                                id="lastname"
                                name="lastname"
                                placeholder="Dupont"
                                value="<%= formData.lastname || '' %>"
                                autocomplete="family-name"
                            >
                            <i class="fas fa-user"></i>
                        </div>
                        <% if (errors && errors.lastname) { %>
                            <p class="ss-reg-error-msg">
                                <i class="fas fa-exclamation-circle"></i>
                                <%= errors.lastname %>
                            </p>
                        <% } %>
                    </div>

                    <!-- Prénom -->
                    <div class="ss-reg-field<% if (errors && errors.firstname) { %> has-error<% } %>">
                        <label class="ss-reg-label" for="firstname">Prénom</label>
                        <div class="ss-reg-input-wrap">
                            <input
                                class="ss-reg-input"
                                type="text"
                                id="firstname"
                                name="firstname"
                                placeholder="Jean"
                                value="<%= formData.firstname || '' %>"
                                autocomplete="given-name"
                            >
                            <i class="fas fa-user"></i>
                        </div>
                        <% if (errors && errors.firstname) { %>
                            <p class="ss-reg-error-msg">
                                <i class="fas fa-exclamation-circle"></i>
                                <%= errors.firstname %>
                            </p>
                        <% } %>
                    </div>

                </div><!-- /.ss-reg-row -->

                <!-- Email -->
                <div class="ss-reg-field<% if (errors && errors.email) { %> has-error<% } %>">
                    <label class="ss-reg-label" for="email">Email</label>
                    <div class="ss-reg-input-wrap">
                        <input
                            class="ss-reg-input"
                            type="email"
                            id="email"
                            name="email"
                            placeholder="jean.dupont@exemple.com"
                            value="<%= formData.email || '' %>"
                            autocomplete="email"
                        >
                        <i class="fas fa-envelope"></i>
                    </div>
                    <% if (errors && errors.email) { %>
                        <p class="ss-reg-error-msg">
                            <i class="fas fa-exclamation-circle"></i>
                            <%= errors.email %>
                        </p>
                    <% } %>
                </div>

                <!-- Mot de passe -->
                <div class="ss-reg-field<% if (errors && errors.password) { %> has-error<% } %>">
                    <label class="ss-reg-label" for="password">Mot de passe</label>
                    <div class="ss-reg-input-wrap">
                        <input
                            class="ss-reg-input"
                            type="password"
                            id="password"
                            name="password"
                            placeholder="Minimum 8 caractères"
                            autocomplete="new-password"
                        >
                        <i class="fas fa-lock"></i>
                    </div>
                    <% if (errors && errors.password) { %>
                        <p class="ss-reg-error-msg">
                            <i class="fas fa-exclamation-circle"></i>
                            <%= errors.password %>
                        </p>
                    <% } %>

                    <!-- Barre de force -->
                    <div class="ss-strength-wrap" id="strengthWrap" style="display:none;">
                        <div class="ss-strength-bar">
                            <div class="ss-strength-seg" id="seg1"></div>
                            <div class="ss-strength-seg" id="seg2"></div>
                            <div class="ss-strength-seg" id="seg3"></div>
                            <div class="ss-strength-seg" id="seg4"></div>
                        </div>
                        <ul class="ss-criteria-list">
                            <li class="ss-criteria-item" id="crit-len">
                                <i class="fas fa-times"></i>
                                8 caractères min.
                            </li>
                            <li class="ss-criteria-item" id="crit-upper">
                                <i class="fas fa-times"></i>
                                1 majuscule
                            </li>
                            <li class="ss-criteria-item" id="crit-num">
                                <i class="fas fa-times"></i>
                                1 chiffre
                            </li>
                            <li class="ss-criteria-item" id="crit-special">
                                <i class="fas fa-times"></i>
                                1 caractère spécial
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Confirmation mot de passe -->
                <div class="ss-reg-field<% if (errors && errors.confirmPassword) { %> has-error<% } %>">
                    <label class="ss-reg-label" for="confirmPassword">Confirmer le mot de passe</label>
                    <div class="ss-reg-input-wrap">
                        <input
                            class="ss-reg-input"
                            type="password"
                            id="confirmPassword"
                            name="confirmPassword"
                            placeholder="Retapez votre mot de passe"
                            autocomplete="new-password"
                        >
                        <i class="fas fa-lock"></i>
                    </div>
                    <% if (errors && errors.confirmPassword) { %>
                        <p class="ss-reg-error-msg">
                            <i class="fas fa-exclamation-circle"></i>
                            <%= errors.confirmPassword %>
                        </p>
                    <% } %>
                </div>

                <!-- Bouton -->
                <button type="submit" class="ss-reg-btn">
                    <i class="fas fa-user-plus"></i>
                    S'inscrire
                </button>

            </form>

            <!-- Lien login -->
            <p class="ss-reg-login-link">
                Déjà un compte ? <a href="/login">Se connecter</a>
            </p>

        </div><!-- /.ss-reg-card -->
    </div><!-- /.ss-reg-page -->

    <!-- JS : barre de force + critères (inline, noncé CSP) -->
    <script nonce="<%= cspNonce %>">
    (function () {
        const pwdInput    = document.getElementById('password');
        const strengthWrap = document.getElementById('strengthWrap');
        const segs        = [
            document.getElementById('seg1'),
            document.getElementById('seg2'),
            document.getElementById('seg3'),
            document.getElementById('seg4'),
        ];
        const crits = {
            len:     document.getElementById('crit-len'),
            upper:   document.getElementById('crit-upper'),
            num:     document.getElementById('crit-num'),
            special: document.getElementById('crit-special'),
        };

        function updateCrit(el, valid) {
            el.classList.toggle('valid', valid);
            el.classList.toggle('invalid', !valid);
            const icon = el.querySelector('i');
            icon.className = valid ? 'fas fa-check' : 'fas fa-times';
        }

        function updateStrength(val) {
            if (!val) {
                strengthWrap.style.display = 'none';
                segs.forEach(s => { s.className = 'ss-strength-seg'; });
                Object.values(crits).forEach(c => {
                    c.classList.remove('valid', 'invalid');
                    c.querySelector('i').className = 'fas fa-times';
                });
                return;
            }

            strengthWrap.style.display = 'block';

            const checks = {
                len:     val.length >= 8,
                upper:   /[A-Z]/.test(val),
                num:     /[0-9]/.test(val),
                special: /[^A-Za-z0-9]/.test(val),
            };

            Object.entries(checks).forEach(([key, ok]) => updateCrit(crits[key], ok));

            const score = Object.values(checks).filter(Boolean).length;

            segs.forEach((s, i) => {
                s.className = 'ss-strength-seg';
                if (i < score) s.classList.add('active-' + score);
            });
        }

        if (pwdInput) {
            pwdInput.addEventListener('input', () => updateStrength(pwdInput.value));
        }
    })();
    </script>

    <%- include('../partials/footer.ejs') %>
</body>
</html>
