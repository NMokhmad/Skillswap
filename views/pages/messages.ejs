<%- include('../partials/header.ejs') %>
</head>

<body>
<%- include('../partials/navbar.ejs') %>

<main class="ss-msg-main">
  <div class="ss-msg-container">

    <!-- Header -->
    <div class="ss-msg-header">
      <i class="fas fa-envelope ss-msg-header-icon"></i>
      <h1 class="ss-msg-title">Mes Messages</h1>
      <p class="ss-msg-subtitle">
        <%= conversations.length %> conversation<%= conversations.length > 1 ? 's' : '' %>
      </p>
    </div>

    <% if (conversations.length === 0) { %>
      <div class="ss-msg-empty">
        <i class="fas fa-comments ss-msg-empty-icon"></i>
        <p class="ss-msg-empty-title">Aucune conversation</p>
        <p class="ss-msg-empty-text">
          Envoyez un message depuis le profil d'un talent pour commencer une conversation.
        </p>
        <a href="/talents" class="ss-msg-empty-btn">
          <i class="fas fa-users"></i>
          <span>Voir les talents</span>
        </a>
      </div>
    <% } else { %>
      <div class="ss-msg-conv-list">
        <% conversations.forEach((conv) => { %>
          <a href="/messages/<%= conv.user.id %>" class="ss-msg-conv-link">
            <div class="ss-msg-conv-card">
              <!-- Avatar -->
              <div class="ss-msg-avatar">
                <span class="ss-msg-avatar-initials">
                  <%= conv.user.firstname.charAt(0).toUpperCase() %><%= conv.user.lastname.charAt(0).toUpperCase() %>
                </span>
              </div>
              <!-- Contenu -->
              <div class="ss-msg-conv-content">
                <div class="ss-msg-conv-header">
                  <p class="ss-msg-conv-name"><%= conv.user.firstname %> <%= conv.user.lastname %></p>
                  <span class="ss-msg-conv-date">
                    <%= new Date(conv.lastMessage.created_at).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' }) %>
                  </span>
                </div>
                <p class="ss-msg-conv-preview"><%= conv.lastMessage.content %></p>
              </div>
              <!-- Badge non-lu -->
              <% if (conv.unreadCount > 0) { %>
                <span class="ss-msg-unread-badge"><%= conv.unreadCount %></span>
              <% } %>
            </div>
          </a>
        <% }) %>
      </div>
    <% } %>

  </div>
</main>

<%- include('../partials/footer.ejs') %>
</body>
</html>
