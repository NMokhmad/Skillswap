<%- include('../partials/header.ejs') %>
</head>

<body>
<%- include('../partials/navbar.ejs') %>

<main class="search-main">
    <section class="search-hero">
        <div class="container">
            <h1 class="title has-text-white search-hero-title">Recherche avancee</h1>
            <p class="search-hero-subtitle">Filtrez les talents par nom, competences, note et localisation.</p>
            <div class="search-hero-input-wrap">
                <input id="searchQueryInput" class="input is-medium search-query-input" type="text" placeholder="Nom ou prenom..." value="<%= initialQuery || '' %>" autocomplete="off">
                <div id="autocompleteDropdown" class="search-autocomplete-dropdown" hidden></div>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="columns search-layout">
                <aside class="column is-4-desktop is-12-tablet">
                    <div class="search-sidebar-box">
                        <h2 class="title is-5 search-sidebar-title">Filtres</h2>

                        <div class="field">
                            <label class="label search-label" for="searchCityInput">Ville</label>
                            <div class="control">
                                <input id="searchCityInput" class="input search-input" type="text" placeholder="Paris, Lyon...">
                            </div>
                        </div>

                        <div class="field">
                            <label class="label search-label" for="searchSortSelect">Tri</label>
                            <div class="control">
                                <div class="select is-fullwidth">
                                    <select id="searchSortSelect">
                                        <option value="rating_desc">Note decroissante</option>
                                        <option value="rating_asc">Note croissante</option>
                                        <option value="newest">Plus recents</option>
                                        <option value="popular">Populaires</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="field">
                            <label class="label search-label" for="minRatingRange">Note minimum: <span id="minRatingValue">0.0</span></label>
                            <div class="control">
                                <input id="minRatingRange" type="range" min="0" max="5" step="0.5" value="0" class="slider is-fullwidth">
                            </div>
                        </div>

                        <div class="field">
                            <label class="label search-label">Competences</label>
                            <div id="skillsFilterList" class="search-skills-list">
                                <% skills.forEach((skill) => { %>
                                    <label class="checkbox search-skill-item">
                                        <input type="checkbox" value="<%= skill.id %>" class="search-skill-checkbox">
                                        <span><%= skill.label %></span>
                                    </label>
                                <% }) %>
                            </div>
                        </div>

                        <div class="buttons">
                            <button id="applyFiltersBtn" class="button search-btn-primary">Appliquer</button>
                            <button id="resetFiltersBtn" class="button search-btn-secondary" type="button">Reinitialiser</button>
                        </div>
                    </div>

                    <% if (user) { %>
                    <div class="search-sidebar-box mt-4">
                        <div class="is-flex is-justify-content-space-between is-align-items-center mb-3">
                            <h3 class="title is-6 mb-0 search-sidebar-title">Recherches sauvegardees</h3>
                            <button id="saveSearchBtn" class="button is-small search-btn-primary" type="button">Sauvegarder</button>
                        </div>
                        <div id="savedSearchesList" class="search-saved-list">
                            <p class="search-muted-text">Chargement...</p>
                        </div>
                    </div>
                    <% } %>
                </aside>

                <div class="column is-8-desktop is-12-tablet">
                    <div class="search-results-box">
                        <div class="is-flex is-justify-content-space-between is-align-items-center mb-4">
                            <p id="resultsSummary" class="search-results-summary">Chargement...</p>
                        </div>

                        <div id="searchResultsGrid" class="columns is-multiline"></div>
                        <nav id="searchPagination" class="pagination is-centered mt-5" hidden></nav>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<script>
  window.SEARCH_CONFIG = {
    initialQuery: <%- JSON.stringify(initialQuery || '') %>,
    isAuthenticated: <%= user ? 'true' : 'false' %>
  };
</script>
<script src="/js/search.js"></script>
<%- include('../partials/footer.ejs') %>
</body>
</html>
