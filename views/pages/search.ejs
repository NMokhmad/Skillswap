<%- include('../partials/header.ejs') %>
</head>

<body>
<%- include('../partials/navbar.ejs') %>

<div class="ss-sr-page">

  <!-- Mini-hero -->
  <section class="ss-sr-hero">
    <h1 class="ss-sr-title">Recherche avancée</h1>
    <p class="ss-sr-subtitle">Filtrez les talents par nom, compétences et note.</p>

    <div class="ss-sr-hero-wrap">
      <input
        id="searchQueryInput"
        type="text"
        class="ss-sr-query-input"
        placeholder="Nom ou prénom..."
        value="<%= initialQuery || '' %>"
        autocomplete="off"
        aria-label="Rechercher un talent"
        aria-controls="autocompleteDropdown"
        aria-autocomplete="list"
      >
      <button id="searchHeroBtn" class="ss-sr-hero-btn" type="button" aria-label="Lancer la recherche">
        <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
        Rechercher
      </button>
      <div id="autocompleteDropdown" class="ss-sr-autocomplete" hidden></div>
    </div>
  </section>

  <!-- Body -->
  <div class="ss-sr-body">
    <div class="ss-sr-layout">

      <!-- Sidebar -->
      <aside class="ss-sr-sidebar">

        <div class="ss-sr-sidebar-box">
          <h2 class="ss-sr-sidebar-title">Filtres</h2>

          <div class="ss-sr-field">
            <label class="ss-sr-label" for="searchSortSelect">Tri</label>
            <select id="searchSortSelect" class="ss-sr-select">
              <option value="rating_desc">Note décroissante</option>
              <option value="rating_asc">Note croissante</option>
              <option value="newest">Plus récents</option>
              <option value="popular">Populaires</option>
            </select>
          </div>

          <div class="ss-sr-field">
            <label class="ss-sr-label" for="minRatingRange">
              Note minimum&nbsp;: <span id="minRatingValue">0.0</span>
            </label>
            <input
              id="minRatingRange"
              type="range"
              min="0" max="5" step="0.5" value="0"
              class="ss-sr-range"
            >
          </div>

          <div class="ss-sr-field">
            <label class="ss-sr-label">Compétences</label>
            <div id="skillsFilterList" class="ss-sr-skills-list">
              <% skills.forEach((skill) => { %>
                <label class="ss-sr-skill-item">
                  <input type="checkbox" value="<%= skill.id %>" class="ss-sr-checkbox">
                  <span><%= skill.label %></span>
                </label>
              <% }) %>
            </div>
          </div>

          <div class="ss-sr-actions">
            <button id="applyFiltersBtn" class="ss-sr-btn-primary" type="button">Appliquer</button>
            <button id="resetFiltersBtn" class="ss-sr-btn-secondary" type="button">Réinitialiser</button>
          </div>
        </div>

        <% if (user) { %>
        <div class="ss-sr-sidebar-box">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.75rem;">
            <h3 class="ss-sr-sidebar-title" style="margin-bottom:0">Recherches sauvegardées</h3>
            <button id="saveSearchBtn" class="ss-sr-btn-primary" type="button">Sauvegarder</button>
          </div>
          <div id="savedSearchesList" class="ss-sr-saved-list">
            <p class="ss-sr-muted">Chargement...</p>
          </div>
        </div>
        <% } %>

      </aside>

      <!-- Résultats -->
      <main class="ss-sr-main">
        <p id="resultsSummary" class="ss-sr-summary">Chargement...</p>
        <div id="searchResultsGrid" class="ss-sr-results-grid"></div>
        <nav id="searchPagination" class="ss-sr-pagination" hidden></nav>
      </main>

    </div>
  </div>

</div>

<script nonce="<%= cspNonce %>">
  window.SEARCH_CONFIG = {
    initialQuery: <%- JSON.stringify(initialQuery || '') %>,
    isAuthenticated: <%= user ? 'true' : 'false' %>
  };
</script>
<script src="/js/search.js"></script>
<%- include('../partials/footer.ejs') %>
</body>
</html>
