<%- include('../partials/header') %>
<script src="/js/editProfil.js" defer></script>
<script src="/js/deleteProfil.js" defer></script>
<script src="/js/previsualition.js" defer></script>
</head>

<%- include('../partials/navbar.ejs') %>

<body>

  <header class="ss-profil-header">
    <i class="fa-solid fa-user-gear ss-profil-header-icon"></i>
    <h1 class="ss-profil-title">Mon Profil</h1>
    <p class="ss-profil-subtitle">Gérez vos informations personnelles</p>
  </header>

  <main class="ss-profil-main">
    <div class="ss-profil-center">

      <!-- Vue profil -->
      <div id="profil-view" class="ss-profil-card">

        <!-- Avatar -->
        <div class="ss-profil-avatar-section">
          <div class="ss-profil-avatar-wrap">
            <% if (user.image) { %>
              <img src="<%= user.image %>" alt="Avatar de <%= user.firstname %>" class="ss-profil-avatar-img">
            <% } else { %>
              <i class="fa-solid fa-user ss-profil-avatar-default"></i>
            <% } %>
          </div>
          <div class="ss-profil-badge">
            <i class="fa-solid fa-circle-check"></i>
            <span>Membre actif</span>
          </div>
        </div>

        <!-- Informations -->
        <div class="ss-profil-info-list">

          <div class="ss-profil-info-row">
            <i class="fa-solid fa-id-card ss-profil-info-icon"></i>
            <div class="ss-profil-info-body">
              <span class="ss-profil-info-label">Prénom</span>
              <span class="ss-profil-info-value"><%= user.firstname %></span>
            </div>
          </div>

          <div class="ss-profil-info-row">
            <i class="fa-solid fa-user ss-profil-info-icon"></i>
            <div class="ss-profil-info-body">
              <span class="ss-profil-info-label">Nom</span>
              <span class="ss-profil-info-value"><%= user.lastname %></span>
            </div>
          </div>

          <div class="ss-profil-info-row">
            <i class="fa-solid fa-envelope ss-profil-info-icon"></i>
            <div class="ss-profil-info-body">
              <span class="ss-profil-info-label">Email</span>
              <span class="ss-profil-info-value"><%= user.email %></span>
            </div>
          </div>

          <% if (user.bio) { %>
            <div class="ss-profil-info-row">
              <i class="fa-solid fa-pen-fancy ss-profil-info-icon"></i>
              <div class="ss-profil-info-body">
                <span class="ss-profil-info-label">À propos de moi</span>
                <span class="ss-profil-info-value"><%= user.bio %></span>
              </div>
            </div>
          <% } %>

        </div>

        <!-- Compétences -->
        <% if (user.skills && user.skills.length > 0) { %>
          <div class="ss-profil-skills-block">
            <p class="ss-profil-skills-title">
              <i class="fa-solid fa-certificate"></i>
              Mes compétences
            </p>
            <div class="ss-profil-tags">
              <% user.skills.forEach((skill, index) => { %>
                <span class="ss-profil-tag ss-profil-tag--<%= index % 4 %>">
                  <i class="fa-solid <%= skill.icon || 'fa-star' %>"></i>
                  <span><%= skill.label %></span>
                </span>
              <% }) %>
            </div>
          </div>
        <% } %>

        <!-- Actions -->
        <div class="ss-profil-actions">
          <button id="editBtn" class="ss-profil-btn-primary">
            <i class="fa-solid fa-pen-to-square"></i>
            <span>Modifier mon profil</span>
          </button>
          <button id="deleteBtn" class="ss-profil-btn-danger">
            <i class="fa-solid fa-trash-can"></i>
            <span>Supprimer mon compte</span>
          </button>
        </div>

      </div>

      <!-- Modal suppression -->
      <div id="delete-confirmation" class="ss-profil-modal">
        <div class="ss-profil-modal-backdrop"></div>
        <div class="ss-profil-modal-box">
          <i class="fa-solid fa-triangle-exclamation ss-profil-modal-warning-icon"></i>
          <h3 class="ss-profil-modal-title">Confirmer la suppression</h3>
          <p class="ss-profil-modal-subtitle">Êtes-vous vraiment sûr de vouloir supprimer votre profil ? Cette action est irréversible.</p>
          <div class="ss-profil-warning-box">
            <i class="fa-solid fa-exclamation-circle"></i>
            Toutes vos données seront définitivement perdues
          </div>
          <div class="ss-profil-modal-actions">
            <form action="/user/<%= user.id %>/profil?_method=DELETE" method="post" class="ss-profil-delete-form">
              <button type="submit" class="ss-profil-btn-delete-confirm">
                <i class="fa-solid fa-trash-can"></i>
                <span>Oui, supprimer définitivement</span>
              </button>
            </form>
            <button id="cancelDelete" class="ss-profil-btn-outline">
              <i class="fa-solid fa-xmark"></i>
              <span>Annuler</span>
            </button>
          </div>
        </div>
        <button class="ss-profil-modal-close" aria-label="Fermer" id="closeModal">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <!-- Formulaire d'édition -->
      <div id="profil-edit" class="ss-profil-edit-card ss-hidden">

        <div class="ss-profil-edit-header">
          <i class="fa-solid fa-user-pen ss-profil-edit-header-icon"></i>
          <h2 class="ss-profil-edit-title">Modifier mes informations</h2>
          <p class="ss-profil-edit-subtitle">Mettez à jour vos informations personnelles</p>
        </div>

        <form action="/user/<%= user.id %>/profil" method="POST" enctype="multipart/form-data">

          <!-- Photo -->
          <div class="ss-profil-field">
            <label class="ss-profil-field-label">
              <i class="fa-solid fa-camera"></i>
              Photo de profil
            </label>
            <div class="ss-profil-avatar-edit-wrap">
              <% if (user.image) { %>
                <img id="avatar-preview-edit" src="<%= user.image %>" alt="Avatar" class="ss-profil-avatar-edit-img">
              <% } else { %>
                <div id="avatar-preview-edit" class="ss-profil-avatar-edit-default">
                  <i class="fa-solid fa-user"></i>
                </div>
              <% } %>
            </div>
            <div class="ss-profil-upload-wrap">
              <label class="ss-profil-upload-cta">
                <i class="fa-solid fa-upload"></i>
                Changer la photo
                <input type="file" name="avatar" id="avatar-edit" accept="image/*">
              </label>
              <span class="ss-profil-upload-filename" id="file-name-edit">
                <%= user.image ? 'Photo actuelle' : 'Aucune photo' %>
              </span>
            </div>
          </div>

          <!-- Prénom -->
          <div class="ss-profil-field">
            <label class="ss-profil-field-label" for="firstname-edit">
              <i class="fa-solid fa-id-card"></i>
              Prénom
            </label>
            <input class="ss-profil-input" type="text" id="firstname-edit" name="firstname" value="<%= user.firstname %>" required>
          </div>

          <!-- Nom -->
          <div class="ss-profil-field">
            <label class="ss-profil-field-label" for="lastname-edit">
              <i class="fa-solid fa-user"></i>
              Nom
            </label>
            <input class="ss-profil-input" type="text" id="lastname-edit" name="lastname" value="<%= user.lastname %>" required>
          </div>

          <!-- Email -->
          <div class="ss-profil-field">
            <label class="ss-profil-field-label" for="email-edit">
              <i class="fa-solid fa-envelope"></i>
              Email
            </label>
            <input class="ss-profil-input" type="email" id="email-edit" name="email" value="<%= user.email %>" required>
          </div>

          <!-- Bio -->
          <div class="ss-profil-field">
            <label class="ss-profil-field-label" for="bio-edit">
              <i class="fa-solid fa-pen-fancy"></i>
              À propos de moi
            </label>
            <textarea class="ss-profil-textarea" name="bio" id="bio-edit" rows="4" maxlength="500" placeholder="Parlez-nous de vous..."><%= user.bio || '' %></textarea>
            <p class="ss-profil-bio-help">
              <span id="bio-count-edit"><%= user.bio ? user.bio.length : 0 %></span>/500 caractères
            </p>
          </div>

          <!-- Info message -->
          <div class="ss-profil-info-msg">
            <i class="fa-solid fa-info-circle"></i>
            Vos modifications seront prises en compte immédiatement
          </div>

          <!-- Boutons -->
          <div class="ss-profil-form-actions">
            <button type="submit" class="ss-profil-btn-primary">
              <i class="fa-solid fa-floppy-disk"></i>
              <span>Enregistrer les modifications</span>
            </button>
            <button type="button" id="cancelEdit" class="ss-profil-btn-outline">
              <i class="fa-solid fa-xmark"></i>
              <span>Annuler</span>
            </button>
          </div>

        </form>
      </div>

    </div>
  </main>

  <%- include('../partials/footer.ejs') %>
</body>
</html>
