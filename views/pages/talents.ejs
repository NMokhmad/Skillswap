<%- include('../partials/header.ejs') %>
</head>

<body>
    <%- include('../partials/navbar.ejs') %>

    <div class="ss-tal-page">

        <!-- Header -->
        <header class="ss-tal-header">
            <h1 class="ss-tal-title">Tous les <em>talents</em></h1>
            <p class="ss-tal-subtitle">Découvrez les experts de notre communauté</p>
            <div class="ss-tal-stats">
                <div class="ss-tal-stat-box">
                    <span class="ss-tal-stat-num"><%= totalUsers %></span>
                    <span class="ss-tal-stat-label">Talents disponibles</span>
                </div>
                <div class="ss-tal-stat-box">
                    <span class="ss-tal-stat-num"><%= users.reduce((sum, u) => sum + u.skills.length, 0) %></span>
                    <span class="ss-tal-stat-label">Compétences partagées</span>
                </div>
            </div>
        </header>

        <!-- Body -->
        <div class="ss-tal-body">

            <!-- Grid -->
            <div class="ss-tal-grid">
                <% users.forEach((user) => { %>
                    <div class="ss-tal-card">

                        <!-- Avatar -->
                        <div class="ss-tal-avatar">
                            <% if (user.avatar) { %>
                                <img src="<%= user.avatar %>" alt="<%= user.firstname %> <%= user.lastname %>">
                            <% } else { %>
                                <%= user.firstname.charAt(0).toUpperCase() %><%= user.lastname.charAt(0).toUpperCase() %>
                            <% } %>
                        </div>

                        <!-- Name -->
                        <a href="/talents/<%= user.id %>" class="ss-tal-name">
                            <%= user.firstname %> <%= user.lastname %>
                        </a>

                        <!-- Stars -->
                        <div class="ss-tal-stars">
                            <div class="ss-tal-stars-row">
                                <% const fullStars = Math.floor(user.averageRating || 0); %>
                                <% const hasHalf = (user.averageRating || 0) % 1 >= 0.5; %>
                                <% for (let i = 0; i < fullStars; i++) { %>
                                    <i class="fas fa-star filled"></i>
                                <% } %>
                                <% if (hasHalf) { %>
                                    <i class="fas fa-star-half-alt filled"></i>
                                <% } %>
                                <% for (let i = fullStars + (hasHalf ? 1 : 0); i < 5; i++) { %>
                                    <i class="far fa-star"></i>
                                <% } %>
                            </div>
                            <span class="ss-tal-rating">(<%= (user.averageRating || 0).toFixed(1) %>/5)</span>
                        </div>

                        <!-- Skills -->
                        <div class="ss-tal-skills">
                            <% user.skills.forEach(skill => { %>
                                <a href="/skills/<%= skill.slug %>" class="ss-tal-pill">
                                    <%= skill.label %>
                                </a>
                            <% }) %>
                        </div>

                        <!-- Actions -->
                        <div class="ss-tal-actions">
                            <% const isFollowing = followedUser && followedUser.followed && followedUser.followed.some(f => f.id === user.id); %>
                            <button
                                class="ss-tal-follow btn-follow <%= isFollowing ? 'is-following' : '' %>"
                                data-user-id="<%= user.id %>"
                                data-following="<%= isFollowing ? 'true' : 'false' %>"
                            >
                                <i class="fas <%= isFollowing ? 'fa-user-minus' : 'fa-user-plus' %>"></i>
                                <span><%= isFollowing ? 'Ne plus suivre' : 'Suivre' %></span>
                            </button>
                            <a href="/messages/<%= user.id %>" class="ss-tal-message">
                                <i class="fas fa-paper-plane"></i>
                                <span>Message</span>
                            </a>
                        </div>

                    </div>
                <% }) %>
            </div>

            <!-- Pagination -->
            <% if (totalPages > 1) { %>
            <nav class="ss-tal-pagination" aria-label="pagination">
                <% if (currentPage > 1) { %>
                    <a class="ss-tal-page-link" href="/talents?page=<%= currentPage - 1 %>">← Précédent</a>
                <% } else { %>
                    <a class="ss-tal-page-link" disabled>← Précédent</a>
                <% } %>

                <% for (let i = 1; i <= totalPages; i++) { %>
                    <a class="ss-tal-page-link <%= i === currentPage ? 'is-current' : '' %>"
                       href="/talents?page=<%= i %>"
                       aria-label="Page <%= i %>">
                        <%= i %>
                    </a>
                <% } %>

                <% if (currentPage < totalPages) { %>
                    <a class="ss-tal-page-link" href="/talents?page=<%= currentPage + 1 %>">Suivant →</a>
                <% } else { %>
                    <a class="ss-tal-page-link" disabled>Suivant →</a>
                <% } %>
            </nav>
            <% } %>

        </div><!-- /.ss-tal-body -->

    </div><!-- /.ss-tal-page -->

    <script src="/js/follow.js"></script>
    <%- include('../partials/footer.ejs') %>
</body>
</html>
